<!DOCTYPE html>
<html lang="en">

<%- include('./header') %>

<body>
  <div>
    <h1 class="display-4">Músicas</h1>
  </div>

  <div class="table-responsive">
    <table class="table text-center">
      <thead class="thead-dark">
        <tr>
          <th scope="col">ID</th>
          <th scope="col">Título</th>
          <th scope="col">Duração</th>
          <th scope="col">ID_Artista</th>
          <th scope="col"><a href="/musicas/incluir" class="text-white"><span class="iconify" style="font-size: 150%;" data-icon="bi:plus-square"></span></a>
          </th>
        </tr>
      </thead>
      <tbody>
        <% musicas.forEach(musica => { %>
          <tr>
            <th scope="row"><%= musica.id %></th>
            <td><%= musica.titulo %></td>
            <td><%= musica.duracao %></td>
            <td><%= musica.artista_id %></td>
            <td>
              <a href="" class="text-success"><span class="iconify" style="font-size: 125%;" data-icon="bi:pencil-square"></span></a>
              &nbsp;
              <a href="" class="text-danger"><span class="iconify" style="font-size: 125%;" data-icon="bi:trash"></span></a>
            </td>
          </tr>
          <% }) %>
      </tbody>
    </table>
  </div>

  <!-- Script de Excluir-->
  <script>
    // Adiciona um listener a todos os botões com a classe
    document.querySelectorAll('.text-danger').forEach(a => {
      a.addEventListener('click', function() {
        // Identifica a linha do botão clicado
        const row = this.closest('tr');

        // Captura o valor do th e do td da linha
        const id = row.querySelector('th').innerText;
        const nome = row.querySelectorAll('td')[0].innerText;
        const genero = row.querySelectorAll('td')[1].innerText;
        
        // Preenche o formulário oculto e envia
        document.getElementById('excluir_id').value = id;
        document.getElementById('excluir_nome').value = nome;
        document.getElementById('excluir_genero').value = genero;
        
        // Preenche o formulário oculto e envia;
        document.getElementById('modal-text').innerText = `${nome}`;
      });
    });
  </script>
</body>
